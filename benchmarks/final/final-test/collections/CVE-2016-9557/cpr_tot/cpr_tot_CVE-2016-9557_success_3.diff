diff --git a/src/libjasper/base/jas_image.c b/src/libjasper/base/jas_image.c
index b40ba0c..d6f1d7b 100644
--- a/src/libjasper/base/jas_image.c
+++ b/src/libjasper/base/jas_image.c
@@ -159,8 +159,8 @@ jas_image_t *jas_image_create(int numcmpts, jas_image_cmptparm_t *cmptparms,
 	rawsize = 0;
 	for (cmptno = 0, cmptparm = cmptparms; cmptno < numcmpts; ++cmptno,
 	  ++cmptparm) {
-		rawsize += cmptparm->width * cmptparm->height *
-		  (cmptparm->prec + 7) / 8;
+		if (((cmptparm->width) == 0 || (cmptparm->height) == 0 || ((cmptparm->prec + 7) / 8) == 0 || (unsigned long long)(cmptparm->width) > 18446744073709551615ULL / (unsigned long long)(cmptparm->height) || (unsigned long long)(cmptparm->height) > 18446744073709551615ULL / (unsigned long long)(((cmptparm->prec + 7) / 8)) || (unsigned long long)rawsize > 18446744073709551615ULL - (unsigned long long)(cmptparm->width) * (unsigned long long)(cmptparm->height) * (unsigned long long)(((cmptparm->prec + 7) / 8))) /* reject zero sizes and detect 64-bit overflow */) return 0; rawsize += cmptparm->width * cmptparm->height *
+	  (cmptparm->prec + 7) / 8; 
 	}
 	/* Decide whether to buffer the image data in memory, based on the
 	  raw size of the image. */
@@ -185,7 +185,6 @@ jas_image_t *jas_image_create(int numcmpts, jas_image_cmptparm_t *cmptparms,
 
 	return image;
 }
-
 jas_image_t *jas_image_create0()
 {
 	jas_image_t *image;
