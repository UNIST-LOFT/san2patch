diff --git a/jdmarker.c b/jdmarker.c
index d8dcba98..70615b49 100644
--- a/jdmarker.c
+++ b/jdmarker.c
@@ -321,6 +321,14 @@ get_sos (j_decompress_ptr cinfo)
 
   cinfo->comps_in_scan = n;
 
+  /* RATIONALE: Validate counts against library limits before writing into
+     fixed-size stacks. Ensure cinfo->num_components and 'n' do not exceed
+     MAX_COMPONENTS to prevent out-of-bounds writes into cur_comp_info[]. */
+  if (cinfo->num_components < 0 || cinfo->num_components > MAX_COMPONENTS)
+    return FALSE;
+  if (n < 0 || n > MAX_COMPONENTS)
+    return FALSE;
+
   /* Collect the component-spec parameters */
 
   for (i = 0; i < cinfo->num_components; i++)
@@ -371,6 +379,7 @@ get_sos (j_decompress_ptr cinfo)
 }
 
 
+
 #ifdef D_ARITH_CODING_SUPPORTED
 
 LOCAL(boolean)
