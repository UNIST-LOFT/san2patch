diff --git a/jdmarker.c b/jdmarker.c
index d8dcba98..b7760943 100644
--- a/jdmarker.c
+++ b/jdmarker.c
@@ -321,7 +321,16 @@ get_sos (j_decompress_ptr cinfo)
 
   cinfo->comps_in_scan = n;
 
-  /* Collect the component-spec parameters */
+// FIXME: Crash CWE-787: Out-of-bounds Write
+   /* Collect the component-spec parameters */
+
+  /*
+   * Rationale: ensure num_components is within the per-scan capacity before
+   * using it as a loop bound. Reject malformed inputs that could cause
+   * out-of-bounds writes.
+   */
+  if (cinfo->num_components > MAX_COMPS_IN_SCAN)
+    ERREXIT(cinfo, JERR_BAD_LENGTH);
 
   for (i = 0; i < cinfo->num_components; i++)
     cinfo->cur_comp_info[i] = NULL;
@@ -371,6 +380,7 @@ get_sos (j_decompress_ptr cinfo)
 }
 
 
+
 #ifdef D_ARITH_CODING_SUPPORTED
 
 LOCAL(boolean)
