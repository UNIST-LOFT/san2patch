diff --git a/jdmarker.c b/jdmarker.c
index d8dcba98..53640f45 100644
--- a/jdmarker.c
+++ b/jdmarker.c
@@ -323,6 +323,15 @@ get_sos (j_decompress_ptr cinfo)
 
   /* Collect the component-spec parameters */
 
+  /* Rationale: ensure the image's declared number of components is valid
+   * and that the scan's component count does not exceed the available
+   * components. This prevents writing past cinfo->cur_comp_info[].
+   */
+  if (cinfo->num_components <= 0 || cinfo->num_components > MAX_COMPONENTS)
+    ERREXIT(cinfo, JERR_COMPONENT_COUNT);
+  if (n > cinfo->num_components)
+    ERREXIT(cinfo, JERR_COMPONENT_COUNT);
+
   for (i = 0; i < cinfo->num_components; i++)
     cinfo->cur_comp_info[i] = NULL;
 
@@ -371,6 +380,7 @@ get_sos (j_decompress_ptr cinfo)
 }
 
 
+
 #ifdef D_ARITH_CODING_SUPPORTED
 
 LOCAL(boolean)
