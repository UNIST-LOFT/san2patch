diff --git a/libtiff/tif_jpeg.c b/libtiff/tif_jpeg.c
index 38595f98..e58b47d8 100644
--- a/libtiff/tif_jpeg.c
+++ b/libtiff/tif_jpeg.c
@@ -1572,7 +1572,6 @@ prepare_JPEGTables(TIFF* tif)
 
 	return (1);
 }
-
 static int
 JPEGSetupEncode(TIFF* tif)
 {
@@ -1644,15 +1643,15 @@ JPEGSetupEncode(TIFF* tif)
 				refbw[4] = refbw[2];
 				refbw[5] = refbw[1];
 				TIFFSetField(tif, TIFFTAG_REFERENCEBLACKWHITE,
-					     refbw);
+					 refbw);
 			}
 		}
 		break;
 	case PHOTOMETRIC_PALETTE:		/* disallowed by Tech Note */
 	case PHOTOMETRIC_MASK:
 		TIFFErrorExt(tif->tif_clientdata, module,
-			  "PhotometricInterpretation %d not allowed for JPEG",
-			  (int) sp->photometric);
+		      "PhotometricInterpretation %d not allowed for JPEG",
+		      (int) sp->photometric);
 		return (0);
 	default:
 		/* TIFF 6.0 forbids subsampling of all other color spaces */
@@ -1676,32 +1675,32 @@ JPEGSetupEncode(TIFF* tif)
 #endif
 	{
 		TIFFErrorExt(tif->tif_clientdata, module, "BitsPerSample %d not allowed for JPEG",
-			  (int) td->td_bitspersample);
+		      (int) td->td_bitspersample);
 		return (0);
 	}
 	sp->cinfo.c.data_precision = td->td_bitspersample;
 #ifdef JPEG_LIB_MK1
         sp->cinfo.c.bits_in_jsample = td->td_bitspersample;
-#endif
-	if (isTiled(tif)) {
+#endif 
+	if (isTiled(tif)) { if (sp->h_sampling < 1 || sp->v_sampling < 1 || td->td_tilelength == 0 || td->td_tilewidth == 0) { TIFFErrorExt(tif->tif_clientdata, module, "Invalid JPEG encoding parameters (zero subsampling or tile dimension)"); return 0; }
 		if ((td->td_tilelength % (sp->v_sampling * DCTSIZE)) != 0) {
 			TIFFErrorExt(tif->tif_clientdata, module,
-				  "JPEG tile height must be multiple of %d",
-				  sp->v_sampling * DCTSIZE);
+			      "JPEG tile height must be multiple of %d",
+			      sp->v_sampling * DCTSIZE);
 			return (0);
 		}
 		if ((td->td_tilewidth % (sp->h_sampling * DCTSIZE)) != 0) {
 			TIFFErrorExt(tif->tif_clientdata, module,
-				  "JPEG tile width must be multiple of %d",
-				  sp->h_sampling * DCTSIZE);
+			      "JPEG tile width must be multiple of %d",
+			      sp->h_sampling * DCTSIZE);
 			return (0);
 		}
 	} else {
 		if (td->td_rowsperstrip < td->td_imagelength &&
 		    (td->td_rowsperstrip % (sp->v_sampling * DCTSIZE)) != 0) {
 			TIFFErrorExt(tif->tif_clientdata, module,
-				  "RowsPerStrip must be multiple of %d for JPEG",
-				  sp->v_sampling * DCTSIZE);
+			      "RowsPerStrip must be multiple of %d for JPEG",
+			      sp->v_sampling * DCTSIZE);
 			return (0);
 		}
 	}
