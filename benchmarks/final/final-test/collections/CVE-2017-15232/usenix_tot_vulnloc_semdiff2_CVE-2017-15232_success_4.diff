diff --git a/jquant1.c b/jquant1.c
index e7814815..6c2ffeb5 100644
--- a/jquant1.c
+++ b/jquant1.c
@@ -531,15 +531,43 @@ quantize_ord_dither (j_decompress_ptr cinfo, JSAMPARRAY input_buf,
   JDIMENSION col;
   JDIMENSION width = cinfo->output_width;
 
+  /* If the buffers themselves are NULL, nothing sensible to do. Return
+   * quietly instead of attempting to use ERREXIT, which may refer to
+   * error codes not available in all builds.
+   */
+  if (input_buf == NULL || output_buf == NULL)
+    return;
+
   for (row = 0; row < num_rows; row++) {
-    /* Initialize output values to 0 so can process components separately */
+    /* If an output row is missing, skip it. If the input row is missing,
+     * zero the output (if present) and skip processing components for that row.
+     */
+    if (output_buf[row] == NULL) {
+      /* nothing we can do for this row */
+      continue;
+    }
+
     jzero_far((void *) output_buf[row], (size_t) (width * sizeof(JSAMPLE)));
     row_index = cquantize->row_index;
+
     for (ci = 0; ci < nc; ci++) {
+      if (input_buf[row] == NULL) {
+        /* no input for this row; skip remaining components */
+        break;
+      }
+
       input_ptr = input_buf[row] + ci;
       output_ptr = output_buf[row];
       colorindex_ci = cquantize->colorindex[ci];
+      /* colorindex_ci should normally be valid; if not, skip this component */
+      if (colorindex_ci == NULL)
+        continue;
+
       dither = cquantize->odither[ci][row_index];
+      /* if dither table is missing, skip this component */
+      if (dither == NULL)
+        continue;
+
       col_index = 0;
 
       for (col = width; col > 0; col--) {
@@ -550,7 +578,7 @@ quantize_ord_dither (j_decompress_ptr cinfo, JSAMPARRAY input_buf,
          * inputs.  The maximum dither is +- MAXJSAMPLE; this sets the
          * required amount of padding.
          */
-        *output_ptr += colorindex_ci[GETJSAMPLE(*input_ptr)+dither[col_index]];
+        *output_ptr += colorindex_ci[GETJSAMPLE(*input_ptr) + dither[col_index]];
         input_ptr += nc;
         output_ptr++;
         col_index = (col_index + 1) & ODITHER_MASK;
@@ -563,6 +591,7 @@ quantize_ord_dither (j_decompress_ptr cinfo, JSAMPARRAY input_buf,
 }
 
 
+
 METHODDEF(void)
 quantize3_ord_dither (j_decompress_ptr cinfo, JSAMPARRAY input_buf,
                       JSAMPARRAY output_buf, int num_rows)
