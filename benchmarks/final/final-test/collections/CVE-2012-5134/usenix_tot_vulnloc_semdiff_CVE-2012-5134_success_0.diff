diff --git a/parser.c b/parser.c
index 0d8d7f2e..7cda15e2 100644
--- a/parser.c
+++ b/parser.c
@@ -4066,17 +4066,19 @@ xmlParseAttValueComplex(xmlParserCtxtPtr ctxt, int *attlen, int normalize) {
 		if (len + 10 > buf_size) {
 		    growBuffer(buf, 10);
 		}
-	    }
-	    NEXTL(l);
-	}
-	GROW;
-	c = CUR_CHAR(l);
     }
-    if (ctxt->instate == XML_PARSER_EOF)
-        goto error;
+    NEXTL(l);
+}
+GROW;
+c = CUR_CHAR(l);
+}
+if (ctxt->instate == XML_PARSER_EOF)
+    goto error;
+// FIXME: Crash CWE-125: Out-of-bounds Read
 
     if ((in_space) && (normalize)) {
-        while (buf[len - 1] == 0x20) len--;
+        /* ensure len > 0 before reading buf[len - 1] to avoid out-of-bounds */
+        while (len > 0 && buf[len - 1] == 0x20) len--;
     }
     buf[len] = 0;
     if (RAW == '<') {
@@ -4084,10 +4086,9 @@ xmlParseAttValueComplex(xmlParserCtxtPtr ctxt, int *attlen, int normalize) {
     } else if (RAW != limit) {
 	if ((c != 0) && (!IS_CHAR(c))) {
 	    xmlFatalErrMsg(ctxt, XML_ERR_INVALID_CHAR,
-			   "invalid character in attribute value\n");
+		           "invalid character in attribute value\n");
 	} else {
-	    xmlFatalErrMsg(ctxt, XML_ERR_ATTRIBUTE_NOT_FINISHED,
-			   "AttValue: ' expected\n");
+	    xmlFatalErrMsg(ctxt, XML_ERR_ATTRIBUTE_NOT_FINISHED,			   "AttValue: ' expected\n");
         }
     } else
 	NEXT;
