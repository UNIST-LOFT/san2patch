diff --git a/libtiff/tif_jpeg.c b/libtiff/tif_jpeg.c
index 6c17c388..3bc59f2b 100644
--- a/libtiff/tif_jpeg.c
+++ b/libtiff/tif_jpeg.c
@@ -1630,7 +1630,8 @@ JPEGSetupEncode(TIFF* tif)
                 {
                     TIFFErrorExt(tif->tif_clientdata, module,
                             "Invalig horizontal/vertical sampling value");
-                    return (0);
+// FIXME: Crash CWE-190: Integer Overflow or Wraparound
+                     return (0);
                 }
 
 		/*
@@ -1643,6 +1644,16 @@ JPEGSetupEncode(TIFF* tif)
 			if (!TIFFGetField(tif, TIFFTAG_REFERENCEBLACKWHITE,
 					  &ref)) {
 				float refbw[6];
+				/* Rationale: Validate bits-per-sample before using it as a
+				 * shift exponent to avoid undefined behavior when shifting
+				 * a 1L by an out-of-range amount. If the value is out of
+				 * range, fail gracefully. */
+				int bits = td->td_bitspersample;
+				if (bits < 0 || bits >= (int)(8 * sizeof(long))) {
+					TIFFErrorExt(tif->tif_clientdata, module,
+						"Invalid bits-per-sample value");
+					return (0);
+				}
 				long top = 1L << td->td_bitspersample;
 				refbw[0] = 0;
 				refbw[1] = (float)(top-1L);
