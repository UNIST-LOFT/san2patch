diff --git a/libtiff/tif_jpeg.c b/libtiff/tif_jpeg.c
index 6c17c388..ddd62429 100644
--- a/libtiff/tif_jpeg.c
+++ b/libtiff/tif_jpeg.c
@@ -1630,7 +1630,8 @@ JPEGSetupEncode(TIFF* tif)
                 {
                     TIFFErrorExt(tif->tif_clientdata, module,
                             "Invalig horizontal/vertical sampling value");
-                    return (0);
+// FIXME: Crash CWE-190: Integer Overflow or Wraparound (can lead to CWE-680: Integer Overflow to Buffer Overflow)
+                     return (0);
                 }
 
 		/*
@@ -1641,8 +1642,19 @@ JPEGSetupEncode(TIFF* tif)
 		{
 			float *ref;
 			if (!TIFFGetField(tif, TIFFTAG_REFERENCEBLACKWHITE,
-					  &ref)) {
+				  &ref)) {
 				float refbw[6];
+				/*
+				 * Rationale: Validate bits-per-sample before performing a left-shift
+				 * to avoid undefined behavior when td_bitspersample is out-of-range
+				 * (C shifts by >= width are UB). If invalid, return error.
+				 */
+				if (td->td_bitspersample <= 0 ||
+				    td->td_bitspersample >= (int)(sizeof(long) * 8)) {
+					TIFFErrorExt(tif->tif_clientdata, module,
+						"Invalid bits-per-sample value (%d)", td->td_bitspersample);
+					return (0);
+				}
 				long top = 1L << td->td_bitspersample;
 				refbw[0] = 0;
 				refbw[1] = (float)(top-1L);
