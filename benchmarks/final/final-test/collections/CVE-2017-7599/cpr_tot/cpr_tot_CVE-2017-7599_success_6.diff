diff --git a/libtiff/tif_dirwrite.c b/libtiff/tif_dirwrite.c
index c9e871be..f50f4e3f 100644
--- a/libtiff/tif_dirwrite.c
+++ b/libtiff/tif_dirwrite.c
@@ -976,8 +976,8 @@ TIFFWriteDirectoryTagSampleformatArray(TIFF* tif, uint32* ndir, TIFFDirEntry* di
 			}
 			else if (tif->tif_dir.td_bitspersample<=16)
 			{
-				for (i = 0; i < count; ++i)
-					((int16*)conv)[i] = (int16)value[i];
+				for (i = 0; i < count; ++i) 
+					((int16*)conv)[i] = (int16)(isfinite(value[i]) ? (value[i] < -32768.0 ? -32768.0 : (value[i] > 32767.0 ? 32767.0 : value[i])) : (TIFFErrorExt(tif->tif_clientdata, module, "Invalid SAMPLEFORMAT_INT value; non-finite encountered"), 0.0)); /* clamp to int16 and report non-finite */
 				ok = TIFFWriteDirectoryTagSshortArray(tif,ndir,dir,tag,count,(int16*)conv);
 			}
 			else
