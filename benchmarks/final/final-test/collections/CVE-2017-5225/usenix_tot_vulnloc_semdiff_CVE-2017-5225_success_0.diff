diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index bdf754c3..83222dc3 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -1068,12 +1068,30 @@ DECLAREcpFunc(cpContig2SeparateByRow)
 	uint32 row;
 	tsample_t s;
 
+	/* Sanity-check scanline sizes returned by the library. */
+	if (scanlinesizein == 0 || scanlinesizeout == 0)
+		goto bad;
+
 	inbuf = _TIFFmalloc(scanlinesizein);
 	outbuf = _TIFFmalloc(scanlinesizeout);
 	if (!inbuf || !outbuf)
 		goto bad;
 	_TIFFmemset(inbuf, 0, scanlinesizein);
 	_TIFFmemset(outbuf, 0, scanlinesizeout);
+
+	/* Ensure the allocated input buffer is large enough for the
+	   worst-case per-pixel stepping used below: (spp * imagewidth)
+	   samples are accessed (worst case s = spp-1), so the buffer
+	   must hold at least spp*imagewidth bytes. If not, fail safely. */
+	{
+		size_t need = (size_t)spp * (size_t)imagewidth;
+		if (need > (size_t)scanlinesizein) {
+			TIFFError(TIFFFileName(in),
+			    "Scanline size too small for image width and samples-per-pixel");
+			goto bad;
+		}
+	}
+
 	/* unpack channels */
 	for (s = 0; s < spp; s++) {
 		for (row = 0; row < imagelength; row++) {
