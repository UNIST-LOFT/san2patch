diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index bdf754c3..0ce34641 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -1067,7 +1067,12 @@ DECLAREcpFunc(cpContig2SeparateByRow)
 	register uint32 n;
 	uint32 row;
 	tsample_t s;
-
+    if (/* Ensure scanline buffers are sane and large enough to hold
+           worst-case per-sample indexing: require scanlinesizein >= spp*imagewidth
+           and scanlinesizeout >= imagewidth. Use wide casts to avoid overflow */
+        (scanlinesizein <= 0 || scanlinesizeout <= 0 ||
+         (unsigned long long)spp * (unsigned long long)imagewidth > (unsigned long long)scanlinesizein ||
+         (unsigned long long)imagewidth > (unsigned long long)scanlinesizeout)) { TIFFError(TIFFFileName(in), "Error"); return 0; }
 	inbuf = _TIFFmalloc(scanlinesizein);
 	outbuf = _TIFFmalloc(scanlinesizeout);
 	if (!inbuf || !outbuf)
