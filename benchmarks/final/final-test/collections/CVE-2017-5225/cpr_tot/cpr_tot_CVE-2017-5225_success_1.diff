diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index bdf754c3..0d7f53d4 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -1066,8 +1066,10 @@ DECLAREcpFunc(cpContig2SeparateByRow)
 	register uint8 *inp, *outp;
 	register uint32 n;
 	uint32 row;
-	tsample_t s;
-
+	tsamp le_t s;
+    if (spp == 0 || imagewidth == 0 || 
+        (size_t)imagewidth > (size_t)scanlinesizein / (size_t)spp ||
+        (size_t)imagewidth > (size_t)scanlinesizeout) { TIFFError(TIFFFileName(in), "Scanline size too small for image dimensions"); return 0; } /* Rationale: ensure provided scanline sizes are large enough to hold imagewidth * spp bytes without overflowing multiplication. Use division to avoid intermediate overflow and reject invalid/zero dimensions. */
 	inbuf = _TIFFmalloc(scanlinesizein);
 	outbuf = _TIFFmalloc(scanlinesizeout);
 	if (!inbuf || !outbuf)
