diff --git a/tools/tiffcp.c b/tools/tiffcp.c
index bdf754c3..9b872d8e 100644
--- a/tools/tiffcp.c
+++ b/tools/tiffcp.c
@@ -1066,8 +1066,24 @@ DECLAREcpFunc(cpContig2SeparateByRow)
 	register uint8 *inp, *outp;
 	register uint32 n;
 	uint32 row;
-	tsample_t s;
-
+	tsamp le_t s;
+    if ({
+        /* Rationale: compute required input bytes as imagewidth * spp with overflow check
+           and ensure the reported scanline sizes are large enough. This defends against
+           under-allocation that leads to OOB reads when indexing by sample offsets. */
+        uint64_t w = (uint64_t)imagewidth;
+        uint64_t nspp = (uint64_t)spp;
+        uint64_t need_in;
+        if (nspp != 0 && w > UINT64_MAX / nspp) {
+            TIFFError(TIFFFileName(in), "Integer overflow computing scanline size");
+            return 0;
+        }
+        need_in = w * nspp; /* assume at least 1 byte per sample for this code path */
+        if ((uint64_t)scanlinesizein < need_in || (uint64_t)scanlinesizeout < (uint64_t)imagewidth) {
+            TIFFError(TIFFFileName(in), "Scanline size too small");
+            return 0;
+        }
+    }) { TIFFError(TIFFFileName(in), "Error"); return 0; }
 	inbuf = _TIFFmalloc(scanlinesizein);
 	outbuf = _TIFFmalloc(scanlinesizeout);
 	if (!inbuf || !outbuf)
