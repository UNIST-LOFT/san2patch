11591 | static bfd_boolean
11592 | target_specific_reloc_handling (Elf_Internal_Rela * reloc,
11593 | 				unsigned char *     start,
11594 | 				Elf_Internal_Sym *  symtab)
11595 | {
11596 |   unsigned int reloc_type = get_reloc_type (reloc->r_info);
11597 | 
11598 |   switch (elf_header.e_machine)
11599 |     {
11600 |     case EM_MSP430:
11601 |     case EM_MSP430_OLD:
11602 |       {
11603 | 	static Elf_Internal_Sym * saved_sym = NULL;
11604 | 
11605 | 	switch (reloc_type)
11606 | 	  {
11607 | 	  case 10: /* R_MSP430_SYM_DIFF */
11608 | 	    if (uses_msp430x_relocs ())
11609 | 	      break;
11610 | 	    /* Fall through.  */
11611 | 	  case 21: /* R_MSP430X_SYM_DIFF */
11612 | 	    saved_sym = symtab + get_reloc_symindex (reloc->r_info);
11613 | 	    return TRUE;
11614 | 
11615 | 	  case 1: /* R_MSP430_32 or R_MSP430_ABS32 */
11616 | 	  case 3: /* R_MSP430_16 or R_MSP430_ABS8 */
11617 | 	    goto handle_sym_diff;
11618 | 
11619 | 	  case 5: /* R_MSP430_16_BYTE */
11620 | 	  case 9: /* R_MSP430_8 */
11621 | 	    if (uses_msp430x_relocs ())
11622 | 	      break;
11623 | 	    goto handle_sym_diff;
11624 | 
11625 | 	  case 2: /* R_MSP430_ABS16 */
11626 | 	  case 15: /* R_MSP430X_ABS16 */
11627 | 	    if (! uses_msp430x_relocs ())
11628 | 	      break;
11629 | 	    goto handle_sym_diff;
11630 | 
11631 | 	  handle_sym_diff:
11632 | 	    if (saved_sym != NULL)
11633 | 	      {
11634 | 		bfd_vma value;
11635 | 
11636 | 		value = reloc->r_addend
11637 | 		  + (symtab[get_reloc_symindex (reloc->r_info)].st_value
11638 | 		     - saved_sym->st_value);
11639 |  // PATCH LOCATION
11640 | 		byte_put (start + reloc->r_offset, value, reloc_type == 1 ? 4 : 2);
11641 | 
11642 | 		saved_sym = NULL;
11643 | 		return TRUE;
11644 | 	      }
11645 | 	    break;
11646 | 
11647 | 	  default:
11648 | 	    if (saved_sym != NULL)
11649 | 	      error (_("Unhandled MSP430 reloc type found after SYM_DIFF reloc\n"));
11650 | 	    break;
11651 | 	  }
11652 | 	break;
11653 |       }
11654 | 
11655 |     case EM_MN10300:
11656 |     case EM_CYGNUS_MN10300:
11657 |       {
11658 | 	static Elf_Internal_Sym * saved_sym = NULL;
11659 | 
11660 | 	switch (reloc_type)
11661 | 	  {
11662 | 	  case 34: /* R_MN10300_ALIGN */
11663 | 	    return TRUE;
11664 | 	  case 33: /* R_MN10300_SYM_DIFF */
11665 | 	    saved_sym = symtab + get_reloc_symindex (reloc->r_info);
11666 | 	    return TRUE;
11667 | 	  case 1: /* R_MN10300_32 */
11668 | 	  case 2: /* R_MN10300_16 */
11669 | 	    if (saved_sym != NULL)
11670 | 	      {
11671 | 		bfd_vma value;
11672 | 
11673 | 		value = reloc->r_addend
11674 | 		  + (symtab[get_reloc_symindex (reloc->r_info)].st_value
11675 | 		     - saved_sym->st_value);
11676 | 
11677 | 		byte_put (start + reloc->r_offset, value, reloc_type == 1 ? 4 : 2);
11678 | 
11679 | 		saved_sym = NULL;
11680 | 		return TRUE;
11681 | 	      }
11682 | 	    break;
11683 | 	  default:
11684 | 	    if (saved_sym != NULL)
11685 | 	      error (_("Unhandled MN10300 reloc type found after SYM_DIFF reloc\n"));
11686 | 	    break;
11687 | 	  }
11688 | 	break;
11689 |       }
11690 | 
11691 |     case EM_RL78:
11692 |       {
11693 | 	static bfd_vma saved_sym1 = 0;
11694 | 	static bfd_vma saved_sym2 = 0;
11695 | 	static bfd_vma value;
11696 | 
11697 | 	switch (reloc_type)
11698 | 	  {
11699 | 	  case 0x80: /* R_RL78_SYM.  */
11700 | 	    saved_sym1 = saved_sym2;
11701 | 	    saved_sym2 = symtab[get_reloc_symindex (reloc->r_info)].st_value;
11702 | 	    saved_sym2 += reloc->r_addend;
11703 | 	    return TRUE;
11704 | 
11705 | 	  case 0x83: /* R_RL78_OPsub.  */
11706 | 	    value = saved_sym1 - saved_sym2;
11707 | 	    saved_sym2 = saved_sym1 = 0;
11708 | 	    return TRUE;
11709 | 	    break;
11710 | 
11711 | 	  case 0x41: /* R_RL78_ABS32.  */
11712 | 	    byte_put (start + reloc->r_offset, value, 4);
11713 | 	    value = 0;
11714 | 	    return TRUE;
11715 | 
11716 | 	  case 0x43: /* R_RL78_ABS16.  */
11717 | 	    byte_put (start + reloc->r_offset, value, 2);
11718 | 	    value = 0;
11719 | 	    return TRUE;
11720 | 
11721 | 	  default:
11722 | 	    break;
11723 | 	  }
11724 | 	break;
11725 |       }
11726 |     }
11727 | 
11728 |   return FALSE;
11729 | }
