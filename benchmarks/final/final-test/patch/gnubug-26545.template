 280 | static void
 281 | fillpattern (int type, unsigned char *r, size_t size)
 282 | {
 283 |   size_t i;
 284 |   unsigned int bits = type & 0xfff;
 285 | 
 286 |   bits |= bits << 12;
 287 |   r[0] = (bits >> 4) & 255;
 288 |   r[1] = (bits >> 8) & 255;
 289 |   r[2] = bits & 255; // PATCH LOCATION 290 |   for (i = 3; i < size / 2; i *= 2)
 291 |     memcpy (r + i, r, i);
 292 |   if (i < size)
 293 |     memcpy (r + i, r, size - i);
 294 | 
 295 |   /* Invert the first bit of every sector. */
 296 |   if (type & 0x1000)
 297 |     for (i = 0; i < size; i += SECTOR_SIZE)
 298 |       r[i] ^= 0x80;
 299 | }
