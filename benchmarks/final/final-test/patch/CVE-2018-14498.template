 123 | METHODDEF(JDIMENSION)
 124 | get_8bit_row (j_compress_ptr cinfo, cjpeg_source_ptr sinfo)
 125 | /* This version is for reading 8-bit colormap indexes */
 126 | {
 127 |   bmp_source_ptr source = (bmp_source_ptr) sinfo;
 128 |   register JSAMPARRAY colormap = source->colormap;
 129 |   JSAMPARRAY image_ptr;
 130 |   register int t;
 131 |   register JSAMPROW inptr, outptr;
 132 |   register JDIMENSION col;
 133 | 
 134 |   /* Fetch next row from virtual array */
 135 |   source->source_row--;
 136 |   image_ptr = (*cinfo->mem->access_virt_sarray)
 137 |     ((j_common_ptr) cinfo, source->whole_image,
 138 |      source->source_row, (JDIMENSION) 1, FALSE);
 139 | 
 140 |   /* Expand the colormap indexes to real data */
 141 |   inptr = image_ptr[0];
 142 |   outptr = source->pub.buffer[0];
 143 |   for (col = cinfo->image_width; col > 0; col--) { // PATCH LOCATION 144 |     t = GETJSAMPLE(*inptr++);
 145 |     *outptr++ = colormap[0][t]; /* can omit GETJSAMPLE() safely */
 146 |     *outptr++ = colormap[1][t];
 147 |     *outptr++ = colormap[2][t];
 148 |   }
 149 | 
 150 |   return 1;
 151 | }
