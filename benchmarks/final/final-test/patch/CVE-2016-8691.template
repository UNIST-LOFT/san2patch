 479 | static int jpc_siz_getparms(jpc_ms_t *ms, jpc_cstate_t *cstate,
 480 |   jas_stream_t *in)
 481 | {
 482 | 	jpc_siz_t *siz = &ms->parms.siz;
 483 | 	unsigned int i;
 484 | 	uint_fast8_t tmp;
 485 | 
 486 | 	/* Eliminate compiler warning about unused variables. */
 487 | 	cstate = 0;
 488 | 
 489 | 	if (jpc_getuint16(in, &siz->caps) ||
 490 | 	  jpc_getuint32(in, &siz->width) ||
 491 | 	  jpc_getuint32(in, &siz->height) ||
 492 | 	  jpc_getuint32(in, &siz->xoff) ||
 493 | 	  jpc_getuint32(in, &siz->yoff) ||
 494 | 	  jpc_getuint32(in, &siz->tilewidth) ||
 495 | 	  jpc_getuint32(in, &siz->tileheight) ||
 496 | 	  jpc_getuint32(in, &siz->tilexoff) ||
 497 | 	  jpc_getuint32(in, &siz->tileyoff) ||
 498 | 	  jpc_getuint16(in, &siz->numcomps)) {
 499 | 		return -1;
 500 | 	}
 501 | 	if (!siz->width || !siz->height || !siz->tilewidth ||
 502 | 	  !siz->tileheight || !siz->numcomps) {
 503 | 		return -1;
 504 | 	}
 505 | 	if (!(siz->comps = jas_alloc2(siz->numcomps, sizeof(jpc_sizcomp_t)))) {
 506 | 		return -1;
 507 | 	}
 508 | 	for (i = 0; i < siz->numcomps; ++i) {
 509 | 		if (jpc_getuint8(in, &tmp) ||
 510 | 		  jpc_getuint8(in, &siz->comps[i].hsamp) ||
 511 | 		  jpc_getuint8(in, &siz->comps[i].vsamp)) {
 512 | 			jas_free(siz->comps);
 513 | 			return -1;
 514 | 		} // PATCH LOCATION
 515 | 		if (<PATCH>) return -1; siz->comps[i].sgnd = (tmp >> 7) & 1;
 516 | 		siz->comps[i].prec = (tmp & 0x7f) + 1;
 517 | 	}
 518 | 	if (jas_stream_eof(in)) {
 519 | 		jas_free(siz->comps);
 520 | 		return -1;
 521 | 	}
 522 | 	return 0;
 523 | }
