9809 | /**
9810 |  * xmlParseEndTag2:
9811 |  * @ctxt:  an XML parser context
9812 |  * @line:  line of the start tag
9813 |  * @nsNr:  number of namespaces on the start tag
9814 |  *
9815 |  * parse an end of tag
9816 |  *
9817 |  * [42] ETag ::= '</' Name S? '>'
9818 |  *
9819 |  * With namespace
9820 |  *
9821 |  * [NS 9] ETag ::= '</' QName S? '>'
9822 |  */
9823 | 
9824 | static void
9825 | xmlParseEndTag2(xmlParserCtxtPtr ctxt, const xmlChar *prefix,
9826 |                 const xmlChar *URI, int line, int nsNr, int tlen) {
9827 |     const xmlChar *name;
9828 | 
9829 |     GROW;
9830 |     if ((RAW != '<') || (NXT(1) != '/')) {
9831 | 	xmlFatalErr(ctxt, XML_ERR_LTSLASH_REQUIRED, NULL);
9832 | 	return;
9833 |     }
9834 |     SKIP(2);
9835 |  // PATCH LOCATION
9836 |     if ((tlen > 0) && (xmlStrncmp(ctxt->input->cur, ctxt->name, tlen) == 0)) {
9837 |         if (ctxt->input->cur[tlen] == '>') {
9838 | 	    ctxt->input->cur += tlen + 1;
9839 | 	    ctxt->input->col += tlen + 1;
9840 | 	    goto done;
9841 | 	}
9842 | 	ctxt->input->cur += tlen;
9843 | 	ctxt->input->col += tlen;
9844 | 	name = (xmlChar*)1;
9845 |     } else {
9846 | 	if (prefix == NULL)
9847 | 	    name = xmlParseNameAndCompare(ctxt, ctxt->name);
9848 | 	else
9849 | 	    name = xmlParseQNameAndCompare(ctxt, ctxt->name, prefix);
9850 |     }
9851 | 
9852 |     /*
9853 |      * We should definitely be at the ending "S? '>'" part
9854 |      */
9855 |     GROW;
9856 |     if (ctxt->instate == XML_PARSER_EOF)
9857 |         return;
9858 |     SKIP_BLANKS;
9859 |     if ((!IS_BYTE_CHAR(RAW)) || (RAW != '>')) {
9860 | 	xmlFatalErr(ctxt, XML_ERR_GT_REQUIRED, NULL);
9861 |     } else
9862 | 	NEXT1;
9863 | 
9864 |     /*
9865 |      * [ WFC: Element Type Match ]
9866 |      * The Name in an element's end-tag must match the element type in the
9867 |      * start-tag.
9868 |      *
9869 |      */
9870 |     if (name != (xmlChar*)1) {
9871 |         if (name == NULL) name = BAD_CAST "unparseable";
9872 |         if ((line == 0) && (ctxt->node != NULL))
9873 |             line = ctxt->node->line;
9874 |         xmlFatalErrMsgStrIntStr(ctxt, XML_ERR_TAG_NAME_MISMATCH,
9875 | 		     "Opening and ending tag mismatch: %s line %d and %s\n",
9876 | 		                ctxt->name, line, name);
9877 |     }
9878 | 
9879 |     /*
9880 |      * SAX: End of Tag
9881 |      */
9882 | done:
9883 |     if ((ctxt->sax != NULL) && (ctxt->sax->endElementNs != NULL) &&
9884 | 	(!ctxt->disableSAX))
9885 | 	ctxt->sax->endElementNs(ctxt->userData, ctxt->name, prefix, URI);
9886 | 
9887 |     spacePop(ctxt);
9888 |     if (nsNr != 0)
9889 | 	nsPop(ctxt, nsNr);
9890 |     return;
9891 | }
