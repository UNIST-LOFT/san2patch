3673 | static int readContigStripsIntoBuffer (TIFF* in, uint8* buf)
3674 | {
3675 |         uint8* bufp = buf;
3676 |         int32  bytes_read = 0;
3677 |         uint32 strip, nstrips   = TIFFNumberOfStrips(in);
3678 |         uint32 stripsize = TIFFStripSize(in);
3679 |         uint32 rows = 0;
3680 |         uint32 rps = TIFFGetFieldDefaulted(in, TIFFTAG_ROWSPERSTRIP, &rps);
3681 |         tsize_t scanline_size = TIFFScanlineSize(in);
3682 | 
3683 |         if (scanline_size == 0) {
3684 |                 TIFFError("", "TIFF scanline size is zero!");    
3685 |                 return 0;
3686 |         }
3687 | 
3688 |         for (strip = 0; strip < nstrips; strip++) {
3689 |                 bytes_read = TIFFReadEncodedStrip (in, strip, bufp, -1);
3690 |                 rows = bytes_read / scanline_size;
3691 |                 if ((strip < (nstrips - 1)) && (bytes_read != (int32)stripsize))
3692 |                         TIFFError("", "Strip %d: read %lu bytes, strip size %lu",
3693 |                                   (int)strip + 1, (unsigned long) bytes_read,
3694 |                                   (unsigned long)stripsize);
3695 | 
3696 |                 if (bytes_read < 0 && !ignore) {
3697 |                         TIFFError("", "Error reading strip %lu after %lu rows",
3698 |                                   (unsigned long) strip, (unsigned long)rows);
3699 |                         return 0;
3700 |                 } // PATCH LOCATION3701 |                 bufp += bytes_read;
3702 |         }
3703 | 
3704 |         return 1;
3705 | } /* end readContigStripsIntoBuffer */
